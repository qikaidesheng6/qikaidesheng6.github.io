<!DOCTYPE html>
<html lang="en">

{% include head.html %}

<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    {% include nav.html %}
    {% include search.html %}

    {{ content }}

    {% include footer.html %}

    <!-- éŸ³ä¹è‡ªåŠ¨æ’­æ”¾ç»„ä»¶ï¼ˆè·¯å¾„æ”¹ä¸º audio æ–‡ä»¶å¤¹ï¼‰ -->
    <audio id="backgroundMusic" loop preload="auto">
        <!-- éŸ³é¢‘è·¯å¾„æŒ‡å‘ç½‘ç«™æ ¹ç›®å½•ä¸‹çš„ audio æ–‡ä»¶å¤¹ -->
        <source src="/audio/zhdap.mp3" type="audio/mpeg">
        <source src="/audio/zhdap.ogg" type="audio/ogg">
        <source src="/audio/zhdap.wav" type="audio/wav">
        <!-- æµè§ˆå™¨ä¸æ”¯æŒ audio æ ‡ç­¾æ—¶çš„é™çº§æç¤º -->
        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾ï¼Œè¯·å‡çº§æµè§ˆå™¨
    </audio>

    <!-- è‡ªåŠ¨æ’­æ”¾è„šæœ¬ï¼ˆå¤„ç†æµè§ˆå™¨é™åˆ¶ï¼‰ -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const audio = document.getElementById('backgroundMusic');
            // å¯é€‰ï¼šè®¾ç½®é»˜è®¤éŸ³é‡ï¼ˆ0-1ä¹‹é—´ï¼Œé¿å…éŸ³é‡è¿‡å¤§ï¼‰
            audio.volume = 0.3; // 30% éŸ³é‡ï¼Œå¯æ ¹æ®éœ€æ±‚è°ƒæ•´

            // æ–¹æ³•1ï¼šå°è¯•ç›´æ¥è‡ªåŠ¨æ’­æ”¾ï¼ˆéƒ¨åˆ†æµè§ˆå™¨æ”¯æŒï¼‰
            function playAudio() {
                audio.play().catch(error => {
                    console.log('ç›´æ¥è‡ªåŠ¨æ’­æ”¾å¤±è´¥ï¼Œéœ€è¦ç”¨æˆ·äº¤äº’ï¼š', error);
                    // æ–¹æ³•2ï¼šç›‘å¬ç”¨æˆ·é¦–æ¬¡äº¤äº’åæ’­æ”¾ï¼ˆå…¼å®¹å¤§éƒ¨åˆ†æµè§ˆå™¨ï¼‰
                    document.addEventListener('click', initAudioPlay, { once: true });
                    document.addEventListener('touchstart', initAudioPlay, { once: true });
                });
            }

            // ç”¨æˆ·äº¤äº’ååˆå§‹åŒ–æ’­æ”¾
            function initAudioPlay() {
                audio.play().then(() => {
                    console.log('éŸ³ä¹å¼€å§‹æ’­æ”¾');
                }).catch(error => {
                    console.log('ç”¨æˆ·äº¤äº’åæ’­æ”¾å¤±è´¥ï¼š', error);
                });
            }

            // åˆå§‹åŒ–æ’­æ”¾
            playAudio();

            // å¯é€‰ï¼šé¡µé¢å¯è§æ€§å˜åŒ–æ—¶å¤„ç†æ’­æ”¾çŠ¶æ€
            document.addEventListener('visibilitychange', function() {
                if (document.visibilityState === 'visible' && audio.paused) {
                    playAudio();
                }
            });
        });
    </script>
<!-- ğŸ‘‡ åœ†å½¢åˆ‡æ¢æŒ‰é’® -->
<div style="position: fixed; bottom: 20px; right: 20px; z-index: 999;">
    <button id="musicToggle" onclick="toggleMusic()" style="width: 50px; height: 50px; border: none; border-radius: 50%; background: #000; color: #fff; cursor: pointer; font-size: 14px; display: flex; align-items: center; justify-content: center;">æ’­æ”¾</button>
</div>

<!-- åˆ‡æ¢é€»è¾‘ + çŠ¶æ€åŒæ­¥ç›‘å¬ï¼ˆä¸å˜ï¼Œä»…æ ·å¼ä¿®æ”¹ï¼‰ -->
<script>
function toggleMusic() {
    const audio = document.getElementById('backgroundMusic');
    audio.paused ? audio.play() : audio.pause();
}

// å®æ—¶åŒæ­¥æŒ‰é’®çŠ¶æ€
const audio = document.getElementById('backgroundMusic');
const btn = document.getElementById('musicToggle');
audio.addEventListener('play', () => {
    btn.textContent = 'æš‚åœ';
    btn.style.background = '#666';
});
audio.addEventListener('pause', () => {
    btn.textContent = 'æ’­æ”¾';
    btn.style.background = '#000';
});
</script>
<!-- Image to hack wechat -->
<img src="/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>