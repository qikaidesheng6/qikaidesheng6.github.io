<!DOCTYPE html>
<html lang="en">

{% include head.html %}

<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    {% include nav.html %}
    {% include search.html %}

    {{ content }}

    {% include footer.html %}

<!-- 背景音乐组件（严格按需播放） -->
<audio id="backgroundMusic" loop preload="auto">
    <source src="/audio/zhdap.mp3" type="audio/mpeg">
    <source src="/audio/zhdap.ogg" type="audio/ogg">
    <source src="/audio/zhdap.wav" type="audio/wav">
    您的浏览器不支持音频播放，请升级浏览器。
</audio>

<!-- 音乐控制按钮（固定在右下角） -->
<div style="position: fixed; bottom: 20px; right: 20px; z-index: 9999;">
    <button id="musicToggle" 
            style="width: 50px; height: 50px; border: none; border-radius: 50%; 
                   background: #000; color: #fff; cursor: pointer; font-size: 14px; 
                   display: flex; align-items: center; justify-content: center;
                   box-shadow: 0 2px 5px rgba(0,0,0,0.3);">
        播放
    </button>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const audio = document.getElementById('backgroundMusic');
    const btn = document.getElementById('musicToggle');
    
    // 设置默认音量
    audio.volume = 0.3;
    
    // 初始状态：确保音乐暂停
    audio.pause();
    btn.textContent = '播放';
    btn.style.background = '#000';
    
    // 按钮点击控制
    btn.addEventListener('click', () => {
        if (audio.paused) {
            // 播放时重置进度（可选：移除此行可保留历史进度）
            // audio.currentTime = 0;
            
            audio.play().then(() => {
                btn.textContent = '暂停';
                btn.style.background = '#666';
            }).catch(err => {
                console.warn('播放失败，请尝试再次点击:', err);
            });
        } else {
            audio.pause();
            btn.textContent = '播放';
            btn.style.background = '#000';
        }
    });
    
    // 页面跳转前强制暂停（关键！）
    window.addEventListener('beforeunload', () => {
        audio.pause();
        // 不保存任何状态 - 每次进入都是新开始
    });
    
    // 额外保障：页面失去焦点时暂停
    document.addEventListener('visibilitychange', () => {
        if (document.visibilityState !== 'visible') {
            audio.pause();
            btn.textContent = '播放';
            btn.style.background = '#000';
        }
    });
});
</script>
<!-- Image to hack wechat -->
<img src="/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>